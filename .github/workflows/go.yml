name: ci

on: [push, pull_request]

jobs:
  test:

    strategy:
      matrix:
        go: ['1.19', '1.20']
        varnish: ['6.0', '7.2', '7.3']

    name: Go ${{ matrix.go }} - Varnish ${{ matrix.varnish }}
    runs-on: ubuntu-latest

    steps:
    - uses: actions/setup-go@v3
      with:
        go-version: ${{ matrix.go }}
    - uses: varnishcache-friends/setup-varnish@v1
      with:
        version: ${{ matrix.varnish }}
    - uses: actions/checkout@v3
    - run: |
        sudo -E su $USER -c "go test -v"
        sudo -E su $USER -c "go vet -unsafeptr=false"
